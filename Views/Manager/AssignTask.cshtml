@model SmartTaskManagement.Models.ViewModels.AssignTaskViewModel
@{
    ViewBag.Title = "Assign Task";
    Layout = "~/Views/Shared/_Layout.cshtml";   // 🔥 USE GLOBAL LAYOUT
}

<h2 class="page-title mb-4">Assign Task to Employee</h2>

<!-- Task Assignment Form -->
@using (Html.BeginForm("AssignTask", "Manager", FormMethod.Post))
{
    @Html.AntiForgeryToken()

    <div class="row g-3">

        <!-- Project Name -->
        <div class="col-md-6">
            @Html.LabelFor(m => m.ProjectName, new { @class = "form-label fw-bold" })
            @Html.TextBoxFor(m => m.ProjectName,
                new { @class = "form-control", placeholder = "Enter project name" })
        </div>

        <!-- Estimated Time -->
        <div class="col-md-6">
            @Html.LabelFor(m => m.EstimatedTime, new { @class = "form-label fw-bold" })
            @Html.TextBoxFor(m => m.EstimatedTime,
                new { @class = "form-control", placeholder = "Estimated hours" })
        </div>

        <!-- Description -->
        <div class="col-12">
            @Html.LabelFor(m => m.Description, new { @class = "form-label fw-bold" })
            @Html.TextAreaFor(m => m.Description,
                new { @class = "form-control", rows = 3, placeholder = "Describe the task..." })
        </div>

        <!-- Status -->
        <div class="col-md-6">
            @Html.LabelFor(m => m.Status, new { @class = "form-label fw-bold" })
            @Html.DropDownListFor(m => m.Status,
                new SelectList(new[] { "ToDo", "Doing", "Hold", "Done" }),
                new { @class = "form-select" })
        </div>

        <!-- Assign To -->
        <div class="col-md-6">
            <label class="form-label fw-bold">Assign To (Employee)</label>
            @Html.DropDownListFor(m => m.AssignedTo, Model.EmployeesInDepartment,
                "-- Select Employee --",
                new { @class = "form-select" })
        </div>

        <!-- Buttons -->
        <div class="col-12 d-flex gap-3 mt-3">
            <button type="submit" class="btn btn-success px-4">Assign Task</button>
            <a href="@Url.Action("Login", "Account")" class="btn btn-secondary px-4">Back</a>
        </div>

    </div>
}

<hr class="my-4" />

<h4 class="text-primary mb-3">Review & Manage Department Tasks</h4>

<!-- Filter -->
<div class="mb-3" style="max-width:300px;">
    <input type="text" id="employeeFilter" class="form-control"
           placeholder="🔍 Filter by employee name...">
</div>

<!-- Task Table -->
<table class="table table-striped table-hover align-middle" id="taskTable">
    <thead class="table-dark">
        <tr>
            <th>Project</th>
            <th>Employee</th>
            <th>Status</th>
            <th>Updated At</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var task in Model.DepartmentTasks ?? new List<SmartTaskManagement.Models.TaskItem>())
        {
            <tr>
                <td>@task.ProjectName</td>
                <td>@(task.AssignedToUser?.Name)</td>
                <td><span class="badge bg-info text-dark">@task.Status</span></td>
                <td>@task.UpdatedAt.ToString("g")</td>
                <td>
                    <a href="@Url.Action("ReviewTask", "Manager", new { id = task.TaskId })"
                       class="btn btn-sm btn-primary">
                        Review
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $("#employeeFilter").on("keyup", function () {
        var value = $(this).val().toLowerCase();
        $("#taskTable tbody tr").filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
        });
    });
</script>
